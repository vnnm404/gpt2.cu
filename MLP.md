# Baseline

B = 4;
S = 64
M = B * S;
K = 768;
N = 3072;

## [0] `NVIDIA GeForce RTX 5060 Ti`
* SM Version: 1200 (PTX Version: 1200)
* Number of SMs: 36
* SM Default Clock Rate: 2602 MHz
* Global Memory: 15711 MiB Free / 15848 MiB Total
* Global Memory Bus Peak: 448 GB/sec (128-bit DDR @14001MHz)
* Max Shared Memory: 100 KiB/SM, 48 KiB/Block
* L2 Cache Size: 32768 KiB
* Maximum Active Blocks: 24/SM
* Maximum Active Threads: 1536/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: No

## OG

`TILE_SIZE`: 32

```
Run:  [1/1] bench_mlp_forward [Device=0 S=64]
Pass: Cold: 0.661276ms GPU, 0.675241ms CPU, 0.50s total GPU, 0.57s total wall, 757x 
Pass: Batch: 0.627479ms GPU, 0.52s total GPU, 0.52s total wall, 830x
```

| Samples |  CPU Time  | Noise |  GPU Time  | Noise | GlobalMem BW | BWUtil | Samples | Batch GPU  |
|---------|------------|-------|------------|-------|--------------|--------|---------|------------|
|    757x | 675.241 us | 0.27% | 661.276 us | 0.22% |  20.236 GB/s |  4.52% |    830x | 627.479 us |


## Warp tiled (2x2 micro tiling)

`MLP_TILE`: 16

```
Run:  [1/1] bench_mlp_forward [Device=0 S=64]
Pass: Cold: 0.409992ms GPU, 0.425268ms CPU, 0.50s total GPU, 0.61s total wall, 1220x 
Pass: Batch: 0.404001ms GPU, 0.52s total GPU, 0.52s total wall, 1285x
```

| Samples |  CPU Time  | Noise |  GPU Time  | Noise | GlobalMem BW | BWUtil | Samples | Batch GPU  |
|---------|------------|-------|------------|-------|--------------|--------|---------|------------|
|   1220x | 425.268 us | 0.36% | 409.992 us | 0.27% |  32.639 GB/s |  7.28% |   1285x | 404.001 us |

```
627.479/404.001 = 1.5531619971237698
```

## Warp tiled (2x2 micro tiling) + Double buffered

`MLP_TILE`: 32

```
Run:  [1/1] bench_mlp_forward [Device=0 S=64]
Pass: Cold: 0.309092ms GPU, 0.323859ms CPU, 0.50s total GPU, 0.65s total wall, 1618x 
Pass: Batch: 0.309478ms GPU, 0.52s total GPU, 0.52s total wall, 1672x
```

| Samples |  CPU Time  | Noise |  GPU Time  | Noise | GlobalMem BW | BWUtil | Samples | Batch GPU  |
|---------|------------|-------|------------|-------|--------------|--------|---------|------------|
|   1618x | 323.859 us | 0.45% | 309.092 us | 0.25% |  43.293 GB/s |  9.66% |   1672x | 309.478 us |

```
627.479/309.478=2.0275399220623114
```

---

# nvbench all new kernels

## bench_mlp_forward

|  S   | Samples |  CPU Time  | Noise |  GPU Time  | Noise | GlobalMem BW | BWUtil | Samples | Batch GPU  |
|------|---------|------------|-------|------------|-------|--------------|--------|---------|------------|
|   64 |   1618x | 323.951 us | 0.43% | 309.120 us | 0.24% |  43.289 GB/s |  9.66% |   1677x | 308.982 us |
|  128 |   1296x | 618.989 us | 0.59% | 603.988 us | 0.57% |  28.666 GB/s |  6.40% |   1297x | 605.082 us |
|  192 |    560x | 909.710 us | 0.50% | 894.234 us | 0.49% |  23.759 GB/s |  5.30% |    588x | 898.490 us |
|  256 |    415x |   1.223 ms | 0.12% |   1.207 ms | 0.08% |  20.852 GB/s |  4.65% |    435x |   1.203 ms |
|  320 |    334x |   1.517 ms | 0.08% |   1.501 ms | 0.03% |  19.391 GB/s |  4.33% |    350x |   1.498 ms |
|  384 |    279x |   1.810 ms | 0.08% |   1.795 ms | 0.05% |  18.407 GB/s |  4.11% |    292x |   1.794 ms |
|  448 |    239x |   2.116 ms | 0.06% |   2.100 ms | 0.04% |  17.607 GB/s |  3.93% |    250x |   2.100 ms |
|  512 |    209x |   2.409 ms | 0.06% |   2.394 ms | 0.04% |  17.086 GB/s |  3.81% |    219x |   2.394 ms |
|  576 |    186x |   2.704 ms | 0.06% |   2.689 ms | 0.03% |  16.676 GB/s |  3.72% |    195x |   2.689 ms |
|  640 |    168x |   3.008 ms | 0.04% |   2.992 ms | 0.03% |  16.298 GB/s |  3.64% |    175x |   2.992 ms |
|  704 |    153x |   3.301 ms | 0.20% |   3.286 ms | 0.20% |  16.039 GB/s |  3.58% |    160x |   3.285 ms |
|  768 |    140x |   3.597 ms | 0.04% |   3.582 ms | 0.03% |  15.812 GB/s |  3.53% |    146x |   3.582 ms |
|  832 |    129x |   3.898 ms | 0.20% |   3.883 ms | 0.20% |  15.599 GB/s |  3.48% |    135x |   3.884 ms |
|  896 |    120x |   4.195 ms | 0.04% |   4.179 ms | 0.02% |  15.433 GB/s |  3.44% |    125x |   4.178 ms |
|  960 |    112x |   4.490 ms | 0.04% |   4.475 ms | 0.03% |  15.293 GB/s |  3.41% |    117x |   4.475 ms |
| 1024 |    105x |   4.792 ms | 0.03% |   4.777 ms | 0.02% |  15.149 GB/s |  3.38% |    110x |   4.775 ms |
| 1088 |     99x |   5.088 ms | 0.03% |   5.072 ms | 0.02% |  15.042 GB/s |  3.36% |    103x |   5.071 ms |
| 1152 |     94x |   5.384 ms | 0.03% |   5.369 ms | 0.02% |  14.944 GB/s |  3.34% |     97x |   5.368 ms |
| 1216 |     89x |   5.681 ms | 0.19% |   5.666 ms | 0.19% |  14.854 GB/s |  3.32% |     92x |   5.668 ms |
| 1280 |     84x |   5.980 ms | 0.03% |   5.965 ms | 0.02% |  14.769 GB/s |  3.30% |     88x |   5.965 ms |
| 1344 |     80x |   6.279 ms | 0.02% |   6.263 ms | 0.02% |  14.693 GB/s |  3.28% |     83x |   6.263 ms |
| 1408 |     77x |   6.577 ms | 0.03% |   6.562 ms | 0.02% |  14.624 GB/s |  3.26% |     80x |   6.580 ms |
| 1472 |     73x |   6.905 ms | 0.02% |   6.889 ms | 0.02% |  14.499 GB/s |  3.24% |     76x |   6.888 ms |
| 1536 |     70x |   7.204 ms | 0.03% |   7.188 ms | 0.02% |  14.443 GB/s |  3.22% |     73x |   7.188 ms |
| 1600 |     67x |   7.501 ms | 0.02% |   7.486 ms | 0.02% |  14.395 GB/s |  3.21% |     70x |   7.485 ms |
| 1664 |     65x |   7.800 ms | 0.02% |   7.785 ms | 0.01% |  14.346 GB/s |  3.20% |     67x |   7.785 ms |
| 1728 |     62x |   8.102 ms | 0.02% |   8.086 ms | 0.01% |  14.298 GB/s |  3.19% |     65x |   8.085 ms |
| 1792 |     60x |   8.398 ms | 0.02% |   8.382 ms | 0.01% |  14.262 GB/s |  3.18% |     62x |   8.382 ms |
| 1856 |     58x |   8.700 ms | 0.02% |   8.684 ms | 0.01% |  14.220 GB/s |  3.17% |     60x |   8.682 ms |
| 1920 |     56x |   9.000 ms | 0.02% |   8.984 ms | 0.01% |  14.182 GB/s |  3.17% |     58x |   8.983 ms |
| 1984 |     54x |   9.295 ms | 0.02% |   9.279 ms | 0.01% |  14.155 GB/s |  3.16% |     56x |   9.278 ms |
| 2048 |     53x |   9.595 ms | 0.02% |   9.580 ms | 0.02% |  14.121 GB/s |  3.15% |     54x |   9.579 ms |

## bench_mlp_backward_input

|  S   | Samples |  CPU Time  | Noise |  GPU Time  | Noise | GlobalMem BW | BWUtil | Samples | Batch GPU  |
|------|---------|------------|-------|------------|-------|--------------|--------|---------|------------|
|   64 |   1086x | 475.786 us | 0.46% | 460.454 us | 0.42% |  29.035 GB/s |  6.48% |   1142x | 453.531 us |
|  128 |    604x | 843.472 us | 0.17% | 828.204 us | 0.12% |  20.890 GB/s |  4.66% |    636x | 824.647 us |
|  192 |    416x |   1.218 ms | 0.17% |   1.203 ms | 0.08% |  17.653 GB/s |  3.94% |    435x |   1.199 ms |
|  256 |    305x |   1.658 ms | 0.12% |   1.642 ms | 0.09% |  15.322 GB/s |  3.42% |    320x |   1.626 ms |
|  320 |    249x |   2.028 ms | 0.08% |   2.013 ms | 0.06% |  14.455 GB/s |  3.23% |    261x |   2.000 ms |
|  384 |    210x |   2.403 ms | 0.07% |   2.388 ms | 0.06% |  13.833 GB/s |  3.09% |    220x |   2.387 ms |
|  448 |    178x |   2.835 ms | 0.08% |   2.820 ms | 0.07% |  13.109 GB/s |  2.93% |    186x |   2.810 ms |
|  512 |    157x |   3.209 ms | 0.08% |   3.194 ms | 0.07% |  12.803 GB/s |  2.86% |    164x |   3.195 ms |
|  576 |    140x |   3.590 ms | 0.07% |   3.575 ms | 0.05% |  12.540 GB/s |  2.80% |    147x |   3.574 ms |
|  640 |    126x |   4.014 ms | 0.07% |   3.999 ms | 0.06% |  12.192 GB/s |  2.72% |    131x |   4.001 ms |
|  704 |    115x |   4.393 ms | 0.08% |   4.377 ms | 0.08% |  12.037 GB/s |  2.69% |    120x |   4.377 ms |
|  768 |    106x |   4.776 ms | 0.05% |   4.761 ms | 0.04% |  11.893 GB/s |  2.65% |    110x |   4.761 ms |
|  832 |     97x |   5.193 ms | 0.08% |   5.177 ms | 0.07% |  11.696 GB/s |  2.61% |    101x |   5.179 ms |
|  896 |     90x |   5.578 ms | 0.59% |   5.559 ms | 0.08% |  11.601 GB/s |  2.59% |     94x |   5.558 ms |
|  960 |     85x |   5.958 ms | 0.05% |   5.943 ms | 0.04% |  11.513 GB/s |  2.57% |     88x |   5.943 ms |
| 1024 |     79x |   6.369 ms | 0.08% |   6.354 ms | 0.08% |  11.388 GB/s |  2.54% |     82x |   6.354 ms |
| 1088 |     75x |   6.752 ms | 0.17% |   6.736 ms | 0.17% |  11.325 GB/s |  2.53% |     78x |   6.741 ms |
| 1152 |     71x |   7.146 ms | 0.04% |   7.131 ms | 0.04% |  11.249 GB/s |  2.51% |     73x |   7.131 ms |
| 1216 |     67x |   7.548 ms | 0.08% |   7.533 ms | 0.08% |  11.170 GB/s |  2.49% |     69x |   7.534 ms |
| 1280 |     64x |   7.938 ms | 0.06% |   7.923 ms | 0.06% |  11.117 GB/s |  2.48% |     66x |   7.921 ms |
| 1344 |     61x |   8.332 ms | 0.05% |   8.317 ms | 0.05% |  11.064 GB/s |  2.47% |     63x |   8.317 ms |
| 1408 |     58x |   8.727 ms | 0.06% |   8.711 ms | 0.06% |  11.014 GB/s |  2.46% |     60x |   8.715 ms |
| 1472 |     55x |   9.123 ms | 0.08% |   9.108 ms | 0.08% |  10.966 GB/s |  2.45% |     57x |   9.108 ms |
| 1536 |     53x |   9.520 ms | 0.04% |   9.504 ms | 0.04% |  10.923 GB/s |  2.44% |     55x |   9.504 ms |
| 1600 |     51x |   9.903 ms | 0.08% |   9.888 ms | 0.07% |  10.897 GB/s |  2.43% |     53x |   9.891 ms |
| 1664 |     49x |  10.301 ms | 0.06% |  10.286 ms | 0.06% |  10.857 GB/s |  2.42% |     51x |  10.286 ms |
| 1728 |     47x |  10.704 ms | 0.04% |  10.689 ms | 0.04% |  10.816 GB/s |  2.41% |     49x |  10.688 ms |
| 1792 |     46x |  11.084 ms | 0.06% |  11.068 ms | 0.06% |  10.800 GB/s |  2.41% |     47x |  11.072 ms |
| 1856 |     44x |  11.488 ms | 0.08% |  11.473 ms | 0.07% |  10.762 GB/s |  2.40% |     45x |  11.474 ms |
| 1920 |     43x |  11.889 ms | 0.03% |  11.873 ms | 0.03% |  10.730 GB/s |  2.39% |     44x |  11.874 ms |
| 1984 |     41x |  12.266 ms | 0.06% |  12.251 ms | 0.06% |  10.721 GB/s |  2.39% |     42x |  12.253 ms |
| 2048 |     40x |  12.670 ms | 0.07% |  12.655 ms | 0.07% |  10.689 GB/s |  2.39% |     41x |  12.655 ms |

## bench_mlp_backward_weight

|  S   | Samples |  CPU Time  | Noise |  GPU Time  | Noise | GlobalMem BW | BWUtil | Samples | Batch GPU  |
|------|---------|------------|-------|------------|-------|--------------|--------|---------|------------|
|   64 |   1288x | 403.502 us | 0.34% | 388.263 us | 0.26% |  34.465 GB/s |  7.69% |   1343x | 388.099 us |
|  128 |    642x | 794.309 us | 0.16% | 779.110 us | 0.13% |  22.223 GB/s |  4.96% |    674x | 775.299 us |
|  192 |    431x |   1.177 ms | 0.12% |   1.161 ms | 0.05% |  18.294 GB/s |  4.08% |    452x |   1.157 ms |
|  256 |    325x |   1.558 ms | 0.46% |   1.543 ms | 0.46% |  16.319 GB/s |  3.64% |    343x |   1.536 ms |
|  320 |    299x |   1.940 ms | 0.49% |   1.924 ms | 0.50% |  15.129 GB/s |  3.38% |    300x |   1.925 ms |
|  384 |    216x |   2.332 ms | 0.06% |   2.316 ms | 0.05% |  14.266 GB/s |  3.18% |    227x |   2.309 ms |
|  448 |    186x |   2.717 ms | 0.06% |   2.702 ms | 0.04% |  13.684 GB/s |  3.05% |    194x |   2.700 ms |
|  512 |    162x |   3.102 ms | 0.06% |   3.086 ms | 0.04% |  13.254 GB/s |  2.96% |    170x |   3.085 ms |
|  576 |    145x |   3.486 ms | 0.05% |   3.471 ms | 0.04% |  12.918 GB/s |  2.88% |    151x |   3.470 ms |
|  640 |    130x |   3.872 ms | 0.04% |   3.857 ms | 0.03% |  12.646 GB/s |  2.82% |    136x |   3.855 ms |
|  704 |    118x |   4.258 ms | 0.27% |   4.243 ms | 0.28% |  12.422 GB/s |  2.77% |    123x |   4.243 ms |
|  768 |    109x |   4.621 ms | 0.08% |   4.606 ms | 0.08% |  12.297 GB/s |  2.74% |    114x |   4.605 ms |
|  832 |    100x |   5.017 ms | 0.05% |   5.001 ms | 0.04% |  12.110 GB/s |  2.70% |    105x |   5.043 ms |
|  896 |     92x |   5.466 ms | 0.05% |   5.450 ms | 0.05% |  11.834 GB/s |  2.64% |     96x |   5.416 ms |
|  960 |     87x |   5.797 ms | 0.04% |   5.782 ms | 0.03% |  11.835 GB/s |  2.64% |     91x |   5.781 ms |
| 1024 |     82x |   6.187 ms | 0.03% |   6.171 ms | 0.03% |  11.727 GB/s |  2.62% |     85x |   6.169 ms |
| 1088 |     77x |   6.574 ms | 0.07% |   6.559 ms | 0.07% |  11.633 GB/s |  2.60% |     80x |   6.556 ms |
| 1152 |     72x |   6.963 ms | 0.03% |   6.947 ms | 0.03% |  11.548 GB/s |  2.58% |     75x |   6.944 ms |
| 1216 |     68x |   7.388 ms | 0.50% |   7.372 ms | 0.50% |  11.416 GB/s |  2.55% |     71x |   7.379 ms |
| 1280 |     65x |   7.787 ms | 0.03% |   7.771 ms | 0.03% |  11.336 GB/s |  2.53% |     67x |   7.768 ms |
| 1344 |     62x |   8.176 ms | 0.03% |   8.160 ms | 0.03% |  11.277 GB/s |  2.52% |     64x |   8.156 ms |
| 1408 |     59x |   8.567 ms | 0.03% |   8.551 ms | 0.03% |  11.222 GB/s |  2.50% |     61x |   8.547 ms |
| 1472 |     56x |   8.955 ms | 0.03% |   8.940 ms | 0.03% |  11.173 GB/s |  2.49% |     58x |   8.935 ms |
| 1536 |     54x |   9.344 ms | 0.03% |   9.328 ms | 0.03% |  11.130 GB/s |  2.48% |     56x |   9.323 ms |
| 1600 |     52x |   9.729 ms | 0.16% |   9.713 ms | 0.17% |  11.093 GB/s |  2.48% |     54x |   9.712 ms |
| 1664 |     50x |  10.126 ms | 0.05% |  10.110 ms | 0.05% |  11.047 GB/s |  2.47% |     52x |  10.106 ms |
| 1728 |     48x |  10.534 ms | 0.06% |  10.519 ms | 0.06% |  10.992 GB/s |  2.45% |     50x |  10.515 ms |
| 1792 |     46x |  10.942 ms | 0.04% |  10.926 ms | 0.04% |  10.942 GB/s |  2.44% |     48x |  10.920 ms |
| 1856 |     45x |  11.344 ms | 0.04% |  11.329 ms | 0.03% |  10.900 GB/s |  2.43% |     46x |  11.324 ms |
| 1920 |     43x |  11.748 ms | 0.03% |  11.732 ms | 0.03% |  10.860 GB/s |  2.42% |     44x |  11.728 ms |
| 1984 |     42x |  12.148 ms | 0.15% |  12.133 ms | 0.15% |  10.826 GB/s |  2.42% |     43x |  12.133 ms |
| 2048 |     40x |  12.554 ms | 0.03% |  12.538 ms | 0.03% |  10.789 GB/s |  2.41% |     41x |  12.534 ms |